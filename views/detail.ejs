<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('includes/head.ejs') %>
    <link rel='stylesheet' href='/stylesheets/detail.css'>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <script
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDEXZPPJSRJ5bgO7BekmmN1nBP6es7Vshs&callback=initMap&v=weekly&language=en"
            defer
    ></script>
    <style>
        #map {
            height: 90%;
            width: 90%;
        }
    </style>
    <script>
        function initMap() {
            const myLatLng = { lat:<%=bird[0].latitude%>, lng:<%=bird[0].longitude%> };
            const map = new google.maps.Map(document.getElementById("map"), {
                zoom: 10,
                center: myLatLng,
            });

            const marker= new google.maps.Marker({
                position: myLatLng,
                icon: {
                    url: "https://cdn3.iconfinder.com/data/icons/halloween-detailed/64/halloween_owl-50.png",
                    scaledSize: new google.maps.Size(50, 50),
                },
                map,
            });
            const infowindow = new google.maps.InfoWindow({
                content: "Latitude: " + <%=bird[0].latitude%> + ", Longitude: " + <%=bird[0].longitude%>,
                maxWidth: 100,
            });


            marker.addListener("click", () => {
                infowindow.open({
                    anchor: marker,
                    map,
                });
            });
        }


        window.initMap = initMap;
    </script>
</head>
<body onload="init()">
<%- include('includes/menu.ejs') %>

<div class="container-fluid">
    <h3><%= title %></h3>
    <form class="form-container" action="/record/update" method="post">
        <div class="all_box">

            <div class="picture_box" id="picture_box">
                <div class="label_box">
                <label>Picture</label>
                </div>
                <div class="picture" style="max-width: 38%; max-height: 45%; justify-content: center; align-items: center;">
                    <img src="<%= bird[0].picture %>" style="max-width:100%; max-height: 100%;justify-content: center">
                </div>


            </div>

                <div class="map_box" id="map_box">
                    <label>Record Location</label>
                    <div id="map"></div>
                </div>

            <div id="description_box"  style="overflow-y:scroll; overflow-x:hidden; height:300px;
            background-color: #f5f5f5;border: 1px solid #e67818;border-radius: 5px;">
                <div >
                    <div>
                        <div id="initial_form" style="display: block">
                            <p style="display: none" >Please insert the id of the Room you want to Join, if you do not have a room id, click Generate Room</p>
                            <form onsubmit="return false;" style="display: none">
                                <p><label for="name" > Your name </label>
                                    <input type="text" id="name" name="name" value="<%= nickname %>">
                                </p>
                                <p>
                                    <label for="roomNo"> Your room </label>
                                    <input type="text" id="roomNo" name="roomNo" value="<%= bird[0].identification %>">
                                    <button id="roomNoGenerator" onclick="generateRoom()">Generate Room</button>
                                </p>
                                <button id="connect" onclick="connectToRoom()">Connect</button>
                            </form>
                        </div>
                        <div id="chat_interface" style="display: none">
                            <div style="padding: 15px;text-align:center;">
                                <div id="who_you_are" style="display: none" value="<%= nickname %>"></div>, <h4> Room: <div id="in_room" style="display: inline"></div></h4>
                            </div>
                            <div id="history" class="boxed"></div>
                            <div id="input" class="bottom boxed">
                                <form id= "chatForm" onsubmit="return false;" style="width: 100%">
                                    <p>
                                        <label for="name"> Chat: </label>
                                        <input type="text" id="chat_input" name="chat_input" style="width: 80%">
                                        <button id="chat_send" onclick="sendChatText()" style="display: block;margin: 20px auto;padding: 10px 10px;font-size: 13px;border-radius: 5px;background-color: orange;color: #fff;cursor: pointer;">Send</button>
                                    </p>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="description-time_box">
                <div class="form-group_ind">
                    <label>Description</label>
                    <span><%= bird[0].description %></span>
                </div>

                <div class="form-group_tim">
                    <label>Time</label>
                    <span><%= bird[0].time %></span>
                </div>
                <style>
                    span {
                        font-size: 15px;
                        color: orange;
                        font-weight: bold;
                        display: block;
                    }
                </style>
            </div>


        </div>

    </form>
</div>

</body>
<footer class="text-muted bg-indigo" id="footer">
    <%- include('includes/footer.ejs') %>
</footer>
<%- include('includes/script.ejs') %>
</html>